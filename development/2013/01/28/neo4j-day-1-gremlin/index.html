
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="author" content="Heather Campbell" />
    <meta name="description" content="Using Gremlin with Neo4J">

    <title>Neo4j Day 1 (Gremlin)</title>

    <link rel="stylesheet" href="/assets/themes/dinky/css/styles.css">
    <link rel="stylesheet" href="/assets/themes/dinky/css/pygment_trac.css">
    <script src="/assets/themes/dinky/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header"><a href="/">Technical Musings of a Mummy</a></h1>
        <ul>
          
          
          


  
    
      
      	
      	<li><a class="button" href="/archive.html" >Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a class="button" href="/categories.html" >Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a class="button" href="/pages/about/index.html" >Me</a></li>
      	
      
    
  
    
      
      	
      	<li><a class="button" href="/pages.html" >Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a class="button" href="/tags.html" >Tags</a></li>
      	
      
    
  



        </ul>
        
        
        <div class="misc vcard">
          <h5 class="connect">Connect with Me</h5>
            

            <a href="mailto:heatherjcampbell@hotmail.co.uk"><img src="/assets/themes/dinky/images/email.png" alt="email"/></a>
            
            
            <a href="http://github.com/heatherjc07/" rel="me"><img src="/assets/themes/dinky/images/github.png" alt="github"/></a>
            
            
            <a href="http://twitter.com/HCampbell07/" rel="me"><img src="/assets/themes/dinky/images/twitter.png" alt="twitter"/></a>
            
            
            
            
            
        </div><!-- misc -->
        
      </header>

      <section>
      
<section>
  <h1>Neo4j Day 1 (Gremlin)</h1>

  <p><em>My experience with Day 1 of <a href='http://www.neo4j.org/'>Neo4j</a> in <a href='http://pragprog.com/book/rwdata/seven-databases-in-seven-weeks'>Seven Databases in Seven Days</a>.</em></p>

<h2 id='what_is_gremlin'>What is Gremlin?</h2>

<p>There are lots of different ways to interact with Neo4j but my first experience was with <a href='https://github.com/tinkerpop/gremlin/wiki'>Gremlin</a>. Gremlin is a graph traversal language written in Groovy. Don&#8217;t worry if you haven&#8217;t any previous Groovy experience because I didn&#8217;t either. We&#8217;ll look at writing some Groovy during this blog when I cover creating Domain Specific steps. Coming from a predominantly Java background I found Groovy easy to pick up as it runs on the JVM and has quite a Java like syntax.</p>

<p>The really handy thing about Gremlin is that the Neo4j web GUI includes a console which you can type your Gremlin commands into and see the results they pull back, no additional set up required. Simply click on the console tab and select Gremlin.</p>

<h2 id='terminology'>Terminology</h2>

<p>In my previous Neo4j post I talked about nodes and the relationships between them. Gremlin uses a slightly different syntax. Instead it talks about vertexes and edges. Different names same concepts.</p>

<p>I&#8217;m going to use the relationships in my immediate family as the data for my Neo4j graph. Below is a basic family tree.</p>

<p><img alt='family tree' src='/assets/themes//dinky/images/neo4j-gremlin/family_tree.JPG' /></p>

<p>The family tree just shows marriages and parent-child relationships but the people in it are related in lots of other ways, aunt, uncles, cousin, grandparents etc. Neo4j is perfect for representing this information as it is highly interconnected information which lots of relationships. Below is a snapshot of the data browser view of neo4j showing all the family members and their relationships.</p>

<p><img alt='family graph' src='/assets/themes//dinky/images/neo4j-gremlin/family_graph.JPG' /></p>

<p>In this blog I&#8217;m going to cover how to create the nodes and relationships to build the graph shown above and demonstrate how we can build queries to return certain information. I&#8217;m also going to cover writing your own Gremlin steps in Groovy to hide complex low level graph manipulation from other developers and allow them to work at a higher abstracted level.</p>

<h2 id='working_with_nodes_and_relationships'>Working with Nodes and Relationships</h2>

<p>Let get started by looking at creating our nodes using Gremlin. Each node has two properties, one to hold the person&#8217;s first name and the other to hold their surname. When I create a node I assign it to a variable. This saves me doing a lookup before I create the relationships.</p>

<p><img alt='create a node' src='/assets/themes//dinky/images/neo4j-gremlin/node_create.JPG' /></p>

<p>Now lets create some relationships for my node.</p>

<p><img alt='create a relationship' src='/assets/themes//dinky/images/neo4j-gremlin/relationship_create.JPG' /></p>

<p>The following commands shows all the nodes and relationships which currently exist.</p>

<p><img alt='list nodes' src='/assets/themes//dinky/images/neo4j-gremlin/node_list.JPG' /><img alt='list relationships' src='/assets/themes//dinky/images/neo4j-gremlin/relationship_list.JPG' /></p>

<p>Once you&#8217;ve created your nodes and relationships you&#8217;ll want to be able to retrieve them and find out information about them. If you know which node represents a person you can use the following command supplying the appropriate node number. The map function allows you to view the properties and verify you have the correct node.</p>

<p><img alt='node properties' src='/assets/themes//dinky/images/neo4j-gremlin/node_property2.JPG' /></p>

<p>You will probably be more likely to retrieve nodes based on their properties. In the following example I retrieve the node which represents me using the filter function and the criteria first_name property equals &#8216;Heather&#8217;. Next I find out the relationships defined between my node the other nodes. outE retrieves the relationships where my node is on the left handside of the relationship e.g. Heather MOTHER_OF Luke and inE the relationships where my node is on the right handside of the relationship e.g. <em>Carolyn SISTER_OF Heather</em>. In a similar fashion outV retrieves the node on the left handside of the relationship and inV the node on the right handside i.e. in the relationship <em>Heather MOTHER_OF Luke</em> Heather is the outV node and Luke is the inV node of the relationship.</p>

<p><img alt='node properties' src='/assets/themes//dinky/images/neo4j-gremlin/node_property.JPG' /></p>

<h2 id='method_chaining'>Method Chaining</h2>

<p>From that last example you&#8217;ve probably realized that Gremlin supports method chaining. This makes for some very succinct code. Each operation takes a collection as input and returns a collection as output. The query below retrieves the first name of all the people who are related to me but have a different surname all neatly summed up in one line.</p>

<p><img alt='related but diff surname' src='/assets/themes//dinky/images/neo4j-gremlin/linked.JPG' /></p>

<h2 id='adding_another_aspect'>Adding another Aspect</h2>

<p>Currently our graph represents the relationships within my family but say I wanted to add another aspect to it and add interests it is as simple as adding some more nodes and relationships. No need to change how our existing family relations data is held. I just add my interests as nodes. Then define who likes them by creating a &#8216;LIKES&#8217; relationship between a person node and an interest node.</p>

<p><img alt='interest nodes' src='/assets/themes//dinky/images/neo4j-gremlin/activities.JPG' /></p>

<p><img alt='relate interests' src='/assets/themes//dinky/images/neo4j-gremlin/activities_rel.JPG' /></p>

<p>Now I can find the names of people who share the same interests as me.</p>

<p><img alt='same interests' src='/assets/themes//dinky/images/neo4j-gremlin/activities_query.JPG' /></p>

<h2 id='creating_your_own_domain_specific_steps'>Creating Your Own Domain Specific Steps</h2>

<p>You can create your own gremlin steps which are meaningful to your business domain. This allows you to hide low level complex graph traversal in a high level step. The example below defines a custom step to retrieve the family relationships for a person. You can see I&#8217;m ignoring relationships from the interests aspect.</p>

<p><img alt='define domain specific set' src='/assets/themes//dinky/images/neo4j-gremlin/DSL_define.GIF' /></p>

<p>This leads to a more meaningful and succinct command.</p>

<p><img alt='result of DSS' src='/assets/themes//dinky/images/neo4j-gremlin/DSL_result.JPG' /></p>

<h2 id='updating_and_deleting'>Updating and Deleting</h2>

<p>Updating and deleting Nodes and Relationships is pretty straight forward. In the example below I add a property weight to the Heather LIKES horse riding relationship.Then I remove it.</p>

<p><img alt='Update then delete' src='/assets/themes//dinky/images/neo4j-gremlin/MOD_DEL.JPG' /></p>

<p>Hopefully this post has given you an introduction to the power of Gremlin. I found it intuitive to use and pretty easy to start writing my own queries and steps. In my next post I&#8217;m going to look at Cypher, Neo4j&#8217;s querying language. I&#8217;m going to demonstrate how we can carry out the actions and queries covered in this post using Cypher.</p>
  If you enjoyed this post, please
<a href="https://twitter.com/intent/tweet?url=http://heatherjcampbell.com/development/2013/01/28/neo4j-day-1-gremlin&text=Neo4j Day 1 (Gremlin) &via=hcampbell07" 
   target="_blank">
  share it</a> 
or 
<a href="https://twitter.com/hcampbell07">
  follow me on Twitter</a>
<div id="page-navigation">
        <div class="clear">&nbsp;</div>
        <div class="left">
        
                <a href="/development/2013/01/22/neo4j-day-1-installing-and-exploring-the-web-gui" title="Previous Post:
Neo4j Day 1 (Installing and Exploring the Web GUI)">&laquo; Neo4j Day 1 (Installing and Exploring the Web GUI)</a>
        
        </div>

        <div class="right">
        
                <a href="/development/2013/01/30/mongodb-day-1-crud-part-1-create" title="next Post:
MongoDB Day 1 (CRUD Part 1: Create)">MongoDB Day 1 (CRUD Part 1: Create) &raquo; </a>
        
        </div>
        <div class="clear">&nbsp;</div>
</div> 
  


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'technicalmusingsofamummy'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




</section>


      </section>

      <footer>
      <p><small>Hosted on <a href="http://pages.github.com/">GitHub Pages</a> using the <a href="https://github.com/sodabrew/theme-dinky">Dinky theme</a> for <a href="http://jekyllbootstrap.com/">Jekyll Bootstrap</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
  </body>
</html>

