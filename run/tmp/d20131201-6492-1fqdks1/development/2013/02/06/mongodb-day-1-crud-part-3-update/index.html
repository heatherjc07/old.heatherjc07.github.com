
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="author" content="Heather Campbell" />
    <meta name="description" content="Updating items in MongoDB">

    <title>MongoDB Day 1 (CRUD Part 3: Update)</title>

    <link rel="stylesheet" href="/assets/themes/dinky/css/styles.css">
    <link rel="stylesheet" href="/assets/themes/dinky/css/pygment_trac.css">
    <script src="/assets/themes/dinky/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header"><a href="/">Technical Musings of a Mummy</a></h1>
        <ul>
          
          
          


  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages/about/index.html">Me</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



        </ul>
        
        
        <div class="misc vcard">
          <h5 class="connect">Connect with Me</h5>
            

            <a href="mailto:heatherjcampbell@hotmail.co.uk"><img src="/assets/themes/dinky/images/email.png" alt="email"/></a>
            
            
            <a href="http://github.com/heatherjc07/" rel="me"><img src="/assets/themes/dinky/images/github.png" alt="github"/></a>
            
            
            <a href="http://twitter.com/HCampbell07/" rel="me"><img src="/assets/themes/dinky/images/twitter.png" alt="twitter"/></a>
            
            
            
            
            
        </div><!-- misc -->
        
      </header>

      <section>
      
<section>
  <h1>MongoDB Day 1 (CRUD Part 3: Update)</h1>

  <p><em>My experience of Day 1 with <a href='http://www.mongodb.org/'>MongoDB</a> in <a href='http://pragprog.com/book/rwdata/seven-databases-in-seven-weeks'>Seven Databases In Seven Weeks</a>.</em></p>

<p>In this post I&#8217;m going to look at the different ways we can update documents within a MongoDB collection. In the collection I&#8217;m going to update is three documents each with <code>_id</code>, <code>name</code> and <code>profession</code> fields.</p>

<p><img alt='data' src='/assets/themes//dinky/images/mongo-crud-update/data.GIF' /></p>

<h2 id='updating_the_whole_document'>Updating the Whole Document</h2>

<p>Here is the document we&#8217;re going to update.</p>

<p><img alt='before' src='/assets/themes//dinky/images/mongo-crud-update/completebefore.GIF' /></p>

<p>If we do an update like the one below we replace the whole of the document rather than just updating the name and gender fields we&#8217;ve specified values for .</p>

<p><img alt='after' src='/assets/themes//dinky/images/mongo-crud-update/completeafter.png' /></p>

<h2 id='updating_a_field'>Updating a Field</h2>

<p>In order to just update an individual field or set of fields we need to use the $set operator in our update command. Here is the document before the update.</p>

<p><img alt='field before' src='/assets/themes//dinky/images/mongo-crud-update/fieldbefore.GIF' /></p>

<p>I&#8217;m going to add a <em>gender</em> field with the value &#8220;female&#8221;.</p>

<p><img alt='field after' src='/assets/themes//dinky/images/mongo-crud-update/fieldafter.png' /></p>

<h2 id='removing_a_field'>Removing a Field</h2>

<p>We can use the $unset command to remove the gender field.</p>

<p><img alt='unset before' src='/assets/themes//dinky/images/mongo-crud-update/unsetbefore.GIF' /></p>

<p><img alt='unset after' src='/assets/themes//dinky/images/mongo-crud-update/unsetafter.GIF' /></p>

<h2 id='updating_arrays'>Updating Arrays</h2>

<p>There are lots of different operators for updating fields with array values. We can add an individual value using the $push operator.</p>

<p><img alt='push' src='/assets/themes//dinky/images/mongo-crud-update/push.png' /></p>

<p>$pop can be used to remove a value at the start or the end of an array. Supply 1 removes the last value.</p>

<p><img alt='pop' src='/assets/themes//dinky/images/mongo-crud-update/pop.png' /></p>

<p>-1 removes the first value.</p>

<p><img alt='pop left' src='/assets/themes//dinky/images/mongo-crud-update/popleft.png' /></p>

<p>$pushAll allows us to add multiple values provided as an array.</p>

<p><img alt='pushall' src='/assets/themes//dinky/images/mongo-crud-update/pushall.png' /></p>

<p>$pull allows us to remove a specific value.</p>

<p><img alt='pull' src='/assets/themes//dinky/images/mongo-crud-update/pull.png' /></p>

<p>$pullAll allows us to remove multiple values. $addToSet treats the array like a set only adding a value if it is unique. The first time we call the command the array does not contain &#8220;sausages&#8221; so it is added. The second time it does so the array is left unchanged.</p>

<p><img alt='addToSet' src='/assets/themes//dinky/images/mongo-crud-update/addToSet.png' /></p>

<p>Compare this to using the $push operator which adds &#8220;sausages&#8221; even though it already exists.</p>

<p><img alt='push duplicate' src='/assets/themes//dinky/images/mongo-crud-update/pushdup.png' /></p>

<p>We can update a specific array element using the $set operator and dot notation. array access begins at 0.</p>

<p><img alt='set' src='/assets/themes//dinky/images/mongo-crud-update/array.png' /></p>

<h2 id='upsert'>Upsert</h2>

<p>There may be occasions when you don&#8217;t know if a document exists or not. We can supply a third parameter to the update function. This is the upsert flag. If we set it to true it means the document will be created if it does not exist or updated if it does. In the example below the first time we issue the update command their is no matching document so it is inserted. The second time there is so the existing document is updated.</p>

<p><img alt='upsert' src='/assets/themes//dinky/images/mongo-crud-update/upsert.png' /></p>

<h2 id='updating_multiple_documents'>Updating Multiple Documents</h2>

<p>By default an update command will only update one document. If your criteria matches multiple documents the document updated will be selected at random. <img alt='updating multiple' src='/assets/themes//dinky/images/mongo-crud-update/multi1.png' /></p>

<p>Adding in a forth parameter to the update command and setting it to true, sets the multi flag and means that all matching documents are updated. <img alt='updating multiple2' src='/assets/themes//dinky/images/mongo-crud-update/multi2.png' /></p>

<p>That completes my brief look at updates in MongoDB. In my final blog on CRUD in MongoDB I&#8217;ll look at removing documents from a collection.</p>

  


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'technicalmusingsofamummy'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




</section>


      </section>

      <footer>
      <p><small>Hosted on <a href="http://pages.github.com/">GitHub Pages</a> using the <a href="https://github.com/sodabrew/theme-dinky">Dinky theme</a> for <a href="http://jekyllbootstrap.com/">Jekyll Bootstrap</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
  </body>
</html>

