
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="author" content="Heather Campbell" />
    <meta name="description" content="Reading items in MongoDB">

    <title>MongoDB Day 1 (CRUD Part 2: Read)</title>

    <link rel="stylesheet" href="/assets/themes/dinky/css/styles.css">
    <link rel="stylesheet" href="/assets/themes/dinky/css/pygment_trac.css">
    <script src="/assets/themes/dinky/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header"><a href="/">Technical Musings of a Mummy</a></h1>
        <ul>
          
          
          


  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages/about/index.html">Me</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



        </ul>
        
        
        <div class="misc vcard">
          <h5 class="connect">Connect with Me</h5>
            

            <a href="mailto:heatherjcampbell@hotmail.co.uk"><img src="/assets/themes/dinky/images/email.png" alt="email"/></a>
            
            
            <a href="http://github.com/heatherjc07/" rel="me"><img src="/assets/themes/dinky/images/github.png" alt="github"/></a>
            
            
            <a href="http://twitter.com/HCampbell07/" rel="me"><img src="/assets/themes/dinky/images/twitter.png" alt="twitter"/></a>
            
            
            
            
            
        </div><!-- misc -->
        
      </header>

      <section>
      
<section>
  <h1>MongoDB Day 1 (CRUD Part 2: Read)</h1>

  <p><em>My experience of Day 1 with <a href='http://www.mongodb.org/'>MongoDB</a> in <a href='http://pragprog.com/book/rwdata/seven-databases-in-seven-weeks'>Seven Databases In Seven Weeks</a>.</em></p>

<p>In this post I&#8217;m going to look at querying MongoDB to find a particular document or set of documents which meet our criteria. I&#8217;m going to use the blogger database and articles collection I created in my previous blog about creating documents in MongoDB.</p>

<p>Here is a reminder of the structure of a typical blog document.</p>

<p><img alt='document structure' src='/assets/themes//dinky/images/mongo-crud-read/find_docs.JPG' /></p>

<p>I&#8217;ve add a few more documents to the database to give me something to search for.</p>

<h2 id='basic_find'>Basic Find</h2>

<p>The basic command for finding documents in my database collection is db.article.find(criteria) I&#8217;ll use the pretty function throughout this blog to make my results more readable. First off lets search for a document based on it&#8217;s unique <code>_id</code> value using the find command.We pass our search criteria as a JSON document. <code>{_id : ObjectId(&quot;Value&quot;)}</code>. The find command returns a cursor of matching documents. We&#8217;re searching for a specific <code>_id</code> which is unique therefore the cursor will only have one document in it. Running the same command without any criteria would return all the documents in the collection.</p>

<p><img alt='search by id' src='/assets/themes//dinky/images/mongo-crud-read/search_id.JPG' /></p>

<p>You can include multiple criteria as comma separated name value pairs. The example below searches for a document with a name field of &#8220;Carolyn McCappin&#8221; and a title of &#8220;Excel Spreadsheets Rock&#8221;.</p>

<p><img alt='search by id' src='/assets/themes//dinky/images/mongo-crud-read/search_id.JPG' /></p>

<p>Another option if you only want to retrieve one document is the findOne command. This returns a single document rather than a cursor. If multiple documents match your criteria the document which is returned will be at random.</p>

<p><img alt='find one' src='/assets/themes//dinky/images/mongo-crud-read/find_one.png' /></p>

<h2 id='controlling_whats_returned'>Controlling What&#8217;s Returned</h2>

<p>We can add a second parameter to the find method to tailor the columns returned. Again this parameter takes the format of a JSON document of name value pairs. In the following example I&#8217;m specifying I just want the title returned (by default the <code>_id</code> field is returned unless you explicitly specify for it not to be.) 1 or true means include.</p>

<p><img alt='return title' src='/assets/themes//dinky/images/mongo-crud-read/search_id_inc.JPG' /></p>

<p>In this example I&#8217;m returning the name and title but explicitly excluding the <code>_id</code> field. 0 or false means exclude.</p>

<p><img alt='exclude id' src='/assets/themes//dinky/images/mongo-crud-read/search_id_ig.JPG' /></p>

<h2 id='using_operators'>Using Operators</h2>

<p>You are not limited to matching specific values. MongoDB queries support a whole range of operators. You can find a list of them <a href='http://docs.mongodb.org/manual/reference/operators/'>here</a> Using the $gt operator to match names greater than &#8220;H&#8221;. The operators are included as a nested document.</p>

<p><img alt='greater than operator' src='/assets/themes//dinky/images/mongo-crud-read/greater.png' /></p>

<p>Using the $regex operator to match names which include &#8220;H&#8221;</p>

<p><img alt='regex' src='/assets/themes//dinky/images/mongo-crud-read/regex.png' /></p>

<p>We can combine conditions to limit the range of a field. For example if we wanted to find documents with a title greater than &#8220;E&#8221; and less than &#8220;F&#8221; we could use the following syntax.</p>

<p><img alt='range' src='/assets/themes//dinky/images/mongo-crud-read/combo_cond.GIF' /></p>

<h2 id='array_fields'>Array Fields</h2>

<p>The documents in the articles collection include an array field called tags which holds the tag values associated with the document. We can use the same operators with array fields as we use with single value fields. For example the following query returns documents whose tags field contains a value beginning with &#8220;s&#8221;.</p>

<p><img alt='array' src='/assets/themes//dinky/images/mongo-crud-read/array.png' /></p>

<p>Sometimes you&#8217;ll want to return documents based on a field containing multiple values. We use the $all operator to achieve this. In the example below we are searching for articles tagged with &#8220;scala&#8221; and &#8220;functional&#8221;.</p>

<p><img alt='all condition' src='/assets/themes//dinky/images/mongo-crud-read/all.png' /></p>

<p>Other times you may want to return documents that match one or more values. We use the $in operator to achieve this. In the example below we are searching for articles tagged with &#8220;scala&#8221; or &#8220;functional&#8221;.</p>

<p><img alt='in' src='/assets/themes//dinky/images/mongo-crud-read/in.png' /></p>

<h2 id='nested_docs'>Nested Docs</h2>

<p>Finding documents based on nested document fields is straightforward. The documents in our collection contain a field called comments whose value is an array of nested comment documents.In the following example I retrieve documents which &#8220;Harold&#8221; has commented on. To access the name field of the documents nested within the comments array I use the dot notation &#8220;comments.name&#8221;.</p>

<p><img alt='nested' src='/assets/themes//dinky/images/mongo-crud-read/nested.png' /></p>

<p>We might want to find documents which &#8220;Harold Potts&#8221; has commented on as being &#8220;Good&#8221; i.e. we want a document with a comments field containing a document with the name equal to &#8220;Harold Potts&#8221; and text containing &#8220;Good&#8221;. The $elemMatch operator allows us to do this.</p>

<p><img alt='element match' src='/assets/themes//dinky/images/mongo-crud-read/element.png' /></p>

<p>Note the difference between this and just listing the field conditions, like in the example below where the name condition and text condition can belong to different comments in the same document and still be considered a match.</p>

<p><img alt='element match 2' src='/assets/themes//dinky/images/mongo-crud-read/element2.png' /></p>

<p>That was a quick look at some of the ways we can search for documents in our database. In my next blog I&#8217;ll cover updating documents.</p>

  


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'technicalmusingsofamummy'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




</section>


      </section>

      <footer>
      <p><small>Hosted on <a href="http://pages.github.com/">GitHub Pages</a> using the <a href="https://github.com/sodabrew/theme-dinky">Dinky theme</a> for <a href="http://jekyllbootstrap.com/">Jekyll Bootstrap</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
  </body>
</html>

